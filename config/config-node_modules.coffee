module.exports = (config) ->
	path = require 'path'
	log  = require "#{config.req.helpers}/log"
	test = require("#{config.req.helpers}/test")()

	# init node_modules
	# =================
	node_modules =
		modules: ['express']
		dist:
			dir: path.join config.dist.rb.server.scripts.dir, 'node_modules'
			modules: {}
		src:
			dir: path.join config.rb.dir, 'node_modules'
			modules: {}

	# modules to copy to server dist
	# ==============================
	addModulesLocPaths = ->
		for module in node_modules.modules
			for loc in ['dist', 'src']
				_path = path.join node_modules[loc].dir, module
				node_modules[loc].modules[module] = _path

	addModulesLocPaths()

	# add node_modules to config
	# ==========================
	config.node_modules = node_modules

	# logs
	# ====
	# log.json node_modules, 'node_modules ='

	# tests
	# =====
	test.log 'true', config.node_modules, 'add node_modules to config'

	# return
	# ======
	config