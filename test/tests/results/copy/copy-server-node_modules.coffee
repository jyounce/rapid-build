# test results: copy-server-node_modules
# ======================================
task         = 'copy-server-node_modules'
fse          = require 'fs-extra'
config       = require "#{process.cwd()}/extra/temp/config.json"
tests        = require("#{config.paths.abs.test.helpers}/tests") config
rbServerPath = config.paths.abs.test.app.dist.server.build
buildPkgName = config.pkgs.rb.name
rbDirName    = buildPkgName
jExpect      = 'jasmine-expect'

# tests
# =====
describe task, ->
	appConfig  = undefined

	beforeAll ->
		appConfig = tests.get.app.config()

	msg1 = "should copy node_modules to server dist #{rbDirName} dir"
	it msg1, (done) ->
		fse.readdir "#{rbServerPath}/node_modules"
		.then (dirs) ->
			expect(dirs).toBeArray()
			done()
		.catch (e) ->
			done.fail e

	msg2  = "should have access to #{buildPkgName}'s node_module #{jExpect} for server testing "
	msg2 += "if testing server"
	it msg2, (done) ->
		return done() unless config.build.is.testServer
		fse.stat "#{config.paths.abs.node_modules}/#{jExpect}"
		.then (stats) ->
			expect(stats.isDirectory()).toBeTrue()
			done()
		.catch (e) ->
			done.fail e