# test results: copy-server-node_modules
# ======================================
task         = 'copy-server-node_modules'
async        = require 'asyncawait/async'
await        = require 'asyncawait/await'
Promise      = require 'bluebird'
fs           = Promise.promisifyAll require 'fs'
config       = require "#{process.cwd()}/extra/temp/config.json"
tests        = require("#{config.paths.abs.test.helpers}/tests") config
rbServerPath = config.paths.abs.test.app.dist.server.build
buildPkgName = config.pkgs.rb.name
rbDirName    = buildPkgName
jExpect      = 'jasmine-expect'

# tests
# =====
describe task, ->
	appConfig  = undefined

	beforeAll ->
		appConfig  = tests.get.app.config()

	msg1 = "should copy node_modules to server dist #{rbDirName} dir"
	it msg1, async (done) ->
		try dirs = await fs.readdirAsync "#{rbServerPath}/node_modules"
		expect(dirs).toBeArray()
		done()

	msg2  = "should have access to #{buildPkgName}'s node_module #{jExpect} for server testing "
	msg2 += "if testing server"
	it msg2, async (done) ->
		return done() unless config.build.is.testServer
		try stats = await fs.statAsync "#{config.paths.abs.node_modules}/#{jExpect}"
		result = stats?.isDirectory()
		expect(result).toBeDefined()
		done()